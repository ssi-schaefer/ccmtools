# -*- python -*-

PROVIDE_SYMBOL('BOOST_THREAD')

REQUIRE_SYMBOL('BOOST_ENTRY', REQUIRED)

PROVIDE_H('boost/thread.hpp')
PROVIDE_H('boost/thread/*')


acm4 = """

AC_DEFUN([CONFIX_BOOST_THREAD],
[
AC_REQUIRE([AC_CANONICAL_TARGET])
AC_REQUIRE([CONFIX_BOOST])
orig_cxxflags=${CXXFLAGS}

# HACK ALERT: boost's libraries seem to be compiled threadingly, by
# default. add -pthread to the compiler commandline, assuming that gcc
# (or any compiler that supports -pthread) is used.

case "$target" in 
    *-*-solaris*)
        THE_FUCKING_AIX_PTHREAD_FLAG=-pthreads
        ;;
    *)
        THE_FUCKING_AIX_PTHREAD_FLAG=-pthread
        ;;
esac

CXXFLAGS="${BOOST_INC} ${CXXFLAGS} ${THE_FUCKING_AIX_PTHREAD_FLAG}"
# Save current programming language (e.g. CC i.e. C)
AC_LANG_SAVE
# Set language to CXX (i.e. C++)
AC_LANG_CPLUSPLUS
# run autoconf check (beware: it must be in the archive)
AX_BOOST_THREAD
# restore previous language again
AC_LANG_RESTORE

# restore previous CXX-flages
CXXFLAGS=${orig_cxxflags}

if test x${BOOST_THREAD_LIB} != x; then
    CONFIX_BOOST_THREAD_LIB="${BOOST_THREAD_LIB}"
fi
# wichtig fuer lib @CONFIX_BOOST_THREAD_LIB@'
AC_SUBST(CONFIX_BOOST_THREAD_LIB)
])

"""

ACINCLUDE_M4(
    lines=[acm4],
    flags=[PROPAGATE])

CONFIGURE_AC(
    lines=['CONFIX_BOOST_THREAD'],
    order=AC_LIBRARIES,
    flags=[PROPAGATE])

EXTERNAL_LIBRARY(
    incpath=['@BOOST_INC@'],
    libpath=['@BOOST_LIB@'],
    libs=['@CONFIX_BOOST_THREAD_LIB@'])
