<%@ jet package="ccmtools.generator.java.templates" 
	    class="ComponentDefAssemblyClassTemplate" 
		imports="java.util.Iterator ccmtools.generator.java.metamodel.* "	    
%>
<% ComponentDef component = (ComponentDef) argument; %>
/**
 * This file was automatically generated by <%=component.generateCcmtoolsVersion()%>
 * <http://ccmtools.sourceforge.net>
 * 
 * <%=component.generateCcmIdentifier()%> component business logic.
 *
 */

package <%=component.generateJavaNamespace()%>;
   
import Components.CCMException;     
import Components.CCMExceptionReason;
import Components.SessionContext; 

<%=component.generateJavaImportStatements()%>  
   
/**
 * This class implements component equivalent and supported interfaces
 * as well as component attributes.
 */   
public class <%=component.getIdentifier()%>Impl 
    implements <%=component.generateCcmIdentifier()%>
{
    /** Supported interface attribute variables */

<%
for(Iterator i = component.getSupports().iterator(); i.hasNext();)
{
    SupportsDef supports = (SupportsDef)i.next();
    for(Iterator j = supports.getInterface().getAllAttributes().iterator(); j.hasNext();)
    {
    	AttributeDef attr = (AttributeDef)j.next();
%>
<%=attr.generateApplicationDeclaration()%>
<%
	}
}
%>    
    

    /** Component attribute variables */
    
<%
for(Iterator i=component.getAttributes().iterator(); i.hasNext();)
{
    AttributeDef attr = (AttributeDef)i.next();
%>
<%=attr.generateApplicationDeclaration()%>
<%
}
%> 
    
<%
for(Iterator i=component.getAssemblyAttributeDeclarations(); i.hasNext();)
{
%>
<%=i.next().toString()%>
<%
}
%> 

    public <%=component.generateCcmIdentifier()%>_Context ctx;
    
    
    public <%=component.getIdentifier()%>Impl()
    {
    }


    /* 
     * Supported interface methods 
     */

    /** Supported interface attributes */

<%
for(Iterator i = component.getSupports().iterator(); i.hasNext();)
{
    SupportsDef supports = (SupportsDef)i.next();
    for(Iterator j = supports.getInterface().getAllAttributes().iterator(); j.hasNext();)
    {
    	AttributeDef attr = (AttributeDef)j.next();
%>
<%=attr.generateApplicationImplementation()%>
<%
	}
}
%>    
    
    
    /** Supported interface methods */
    
<%
for(Iterator i = component.getSupports().iterator(); i.hasNext();)
{
    SupportsDef supports = (SupportsDef)i.next();
    for(Iterator j = supports.getInterface().getAllOperations().iterator(); j.hasNext();)
    {
    	OperationDef op = (OperationDef)j.next();
%>
<%=op.generateApplicationImplementation()%>
<%
	}
}
%>    


    /** Component attribute accessor methods */

<%
for(Iterator i = component.getAttributes().iterator(); i.hasNext();)
{
    AttributeDef attr = (AttributeDef)i.next();
%>
<%=attr.generateApplicationImplementation()%>
<%
}
%>    


    /** Facet implementation factory methods */
    
<%
for(Iterator i = component.getFacet().iterator(); i.hasNext();)
{
    ProvidesDef provides = (ProvidesDef)i.next();
%>
<%=provides.generateGetMethodAssemblyImplementation()%>
<%
}
%>    

    /** Component callback methods */
    
    public void set_session_context(SessionContext ctx) 
        throws CCMException
    {
        this.ctx = (<%=component.generateCcmIdentifier()%>_Context)ctx; 
    }

    public void ccm_activate() 
        throws CCMException
    {
    	try {
			// create inner components    	
<%
for(Iterator i=component.getAssemblyAttributeInitialisation(); i.hasNext();)
{
%>
<%=i.next().toString()%>
<%
}
%> 

			// setup inner components    	
<%
for(Iterator i=component.getAssemblyAttributeSetup(); i.hasNext();)
{
%>
<%=i.next().toString()%>
<%
}
%> 

			// finish configuration    	
<%
for (String key : component.getAssemblyLocalComponents().keySet())
{
%>
			<%=key%>_.configuration_complete();
<%
}
%> 
    	} catch(Exception e) {
    		throw new CCMException(e.getMessage(), CCMExceptionReason.CREATE_ERROR);
    	}
    }

    public void ccm_passivate() 
        throws CCMException
    {
        // Who calls this method?
    }

    public void ccm_remove() 
        throws CCMException
    {
    	try {
<%
for (String key : component.getAssemblyLocalComponents().keySet())
{
%>
			<%=key%>_.remove();
<%
}
%>
		} catch(Exception e) {
    		throw new CCMException(e.getMessage(), CCMExceptionReason.REMOVE_ERROR);
		} 
    }
}
