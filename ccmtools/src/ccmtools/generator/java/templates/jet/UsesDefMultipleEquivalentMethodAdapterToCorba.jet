<%@ jet package="ccmtools.generator.java.templates" 
	    class="UsesDefMultipleEquivalentMethodAdapterToCorbaTemplate" 
		imports="ccmtools.generator.java.metamodel.* "	    
%>
<% 
UsesDef uses = (UsesDef) argument;  
InterfaceDef iface = uses.getInterface();
%>

    public Components.Cookie connect_<%=uses.getIdentifier()%>(<%=iface.generateAbsoluteJavaName()%> localObject)
        throws Components.ExceededConnectionLimit, Components.InvalidConnection
    {
        logger.fine("Object reference = " + localObject);
        try
        {
            if(localObject == null)
            {
                throw new Components.InvalidConnection();
            }
            else
            {
            	org.omg.PortableServer.Servant servant = new <%=iface.generateAbsoluteJavaRemoteName()%>AdapterFromCorba(localObject);
                org.omg.CORBA.Object remoteObject =  componentPoa.servant_to_reference(servant);
                ccmtools.corba.Components.Cookie rck = 
                    remoteInterface.connect_<%=uses.getIdentifier()%>(<%=iface.generateAbsoluteIdlName()%>Helper.narrow(remoteObject));
                Components.Cookie ck = new Components.CookieImpl(rck.CookieValue);
                portReceptacleMap.put(ck, localObject);
                return ck;
            }
        }
        catch (org.omg.PortableServer.POAPackage.ServantNotActive e)
        {
            throw new Components.InvalidConnection();
        }
        catch (org.omg.PortableServer.POAPackage.WrongPolicy e)
        {
            throw new Components.InvalidConnection();
        }
        catch(ccmtools.corba.Components.ExceededConnectionLimit e)
        {
            throw new Components.ExceededConnectionLimit();
        }
        catch(ccmtools.corba.Components.InvalidConnection e)
        {
            throw new Components.InvalidConnection();
        }
    }

    public <%=iface.generateAbsoluteJavaName()%> disconnect_<%=uses.getIdentifier()%>(Components.Cookie ck)
        throws Components.InvalidConnection
    {
        logger.fine("Cookie = " + ck);
        try
        {
            if(ck == null || !<%=uses.getIdentifier()%>ReceptacleMap.containsKey(ck))
            {
                throw new Components.InvalidConnection();
            }
            else
            {
                ccmtools.corba.Components.Cookie rck = 
                    new ccmtools.corba.Components.CookieImpl(ck.getCookieValue());
                remoteInterface.disconnect_port(rck);	
                <%=iface.generateAbsoluteJavaName()%> obj = <%=uses.getIdentifier()%>ReceptacleMap.get(ck);
                <%=uses.getIdentifier()%>ReceptacleMap.remove(ck);	
                return obj;
            }
        }
        catch(ccmtools.corba.Components.InvalidConnection e)
        {
            e.printStackTrace();
            throw new Components.InvalidConnection();
        }
    }

    public Map<Components.Cookie, <%=uses.getInterface().generateAbsoluteJavaName()%>> get_connections_<%=uses.getIdentifier()%>()
    {
        logger.fine("");
        // return a copy of the receptacle map
        return new java.util.HashMap<Components.Cookie, <%=iface.generateAbsoluteJavaName()%>>(<%=uses.getIdentifier()%>ReceptacleMap);
    }
