/*
 * This file was automatically generated by %(CcmToolsVersion)s
 * <http://ccmtools.sourceforge.net/>
 * DO NOT EDIT !
 */

//==============================================================================
// %(Identifier)s - component home logic (header)
//==============================================================================

#ifndef __HOME_%(PreprocIdentifier)s_GEN__H__
#define __HOME_%(PreprocIdentifier)s_GEN__H__

#include <string>
#include <map>

#include <Components/CCM.h>

%(MFactoryDefInclude)s
%(MFinderDefInclude)s
%(MSupportsDefInclude)s
%(BaseInclude)s

#include "%(ComponentType)s_gen.h"

%(OpenNamespace)s

//==============================================================================
// explicit support classes
//==============================================================================

class %(Identifier)sExplicit
    : virtual public ::Components::CCMHome
{
  public:
    virtual ~%(Identifier)sExplicit() {}
    
%(MFactoryDefAdapterPrototypeVV)s
};

//==============================================================================
// implicit support classes
//==============================================================================

class %(Identifier)sImplicit
    : virtual public ::Components::KeylessCCMHome
{
  public:
    virtual ~%(Identifier)sImplicit() {}
    
    virtual wamas::platform::utils::SmartPtr< %(ComponentType)s> create()
        throw(::Components::CCMException, ::Components::CreateFailure) = 0;
};




//==============================================================================
// home and home adapter classes
//==============================================================================

class %(Identifier)s
    : virtual public %(Identifier)sExplicit, 
      virtual public %(Identifier)sImplicit%(BaseType)s
{
  public:
    %(Identifier)s();
    %(Identifier)s(wamas::platform::utils::SmartPtr< ::Components::AssemblyFactory> assembly_factory);	
    virtual ~%(Identifier)s();

%(MFactoryDefAdapterPrototypeV)s

    // CCMHome functions
    virtual wamas::platform::utils::SmartPtr<%(ComponentType)s> create()
        throw(::Components::CCMException, ::Components::CreateFailure);

    virtual void remove_component(
	    wamas::platform::utils::SmartPtr< ::Components::CCMObject> component)
        throw(::Components::CCMException, ::Components::RemoveFailure);

    // KeylessCCMHome functions
    virtual wamas::platform::utils::SmartPtr< ::Components::CCMObject> create_component()
        throw(::Components::CCMException, ::Components::CreateFailure);

  protected:
    %(LocalNamespace)sCCM_%(Identifier)s* local_home;
    wamas::platform::utils::SmartPtr< ::Components::AssemblyFactory> assembly_factory;
    
  private:
    %(Identifier)s(const %(Identifier)s&);
    void operator=(const %(Identifier)s&);
};

%(CloseNamespace)s

//==============================================================================
// entry point
//==============================================================================

wamas::platform::utils::SmartPtr< ::Components::CCMHome> 
create_%(AbsoluteLocalHomeName)sAdapter();

int 
deploy_%(AbsoluteLocalHomeName)s(char* name);

int 
deploy_with_assembly_%(AbsoluteLocalHomeName)s(char* name,	
        wamas::platform::utils::SmartPtr< ::Components::AssemblyFactory> assembly_factory);

int undeploy_%(AbsoluteLocalHomeName)s(char* name);

#endif


<<<<<<<SPLIT>>>>>>>
/*
 * This file was automatically generated by %(CcmToolsVersion)s
 * <http://ccmtools.sourceforge.net/>
 * DO NOT EDIT !
 */

//==============================================================================
// %(Identifier)s - component home logic (implementation)
//==============================================================================

#include <cassert>
#include <iostream>

#include "%(Identifier)s_gen.h"
#include <%(AbsoluteLocalHomeName)s_entry.h>

%(OpenNamespace)s

using namespace std;
using namespace wamas::platform::utils;

//==============================================================================
// home adapter implementation
//==============================================================================

%(Identifier)s::%(Identifier)s()
{
    local_home = dynamic_cast< %(LocalNamespace)sCCM_%(Identifier)s*>(
        create%(AbsoluteLocalHomeName)s());
    assembly_factory = SmartPtr< ::Components::AssemblyFactory>();
}

%(Identifier)s::%(Identifier)s(SmartPtr< ::Components::AssemblyFactory> f)
    : assembly_factory(f)
{
    local_home = dynamic_cast< %(LocalNamespace)sCCM_%(Identifier)s*>(
        create%(AbsoluteLocalHomeName)s());
}

%(Identifier)s::~%(Identifier)s()
{
    delete local_home;
}

%(MFactoryDefAdapterDefinition)s

// CCMHome functions

SmartPtr<%(ComponentType)s>
%(Identifier)s::create()
    throw(::Components::CCMException, ::Components::CreateFailure)
{
    SmartPtr< ::Components::Assembly> assembly;
    if(assembly_factory != SmartPtr< ::Components::AssemblyFactory>()) 
    {
        assembly = assembly_factory->create(); 
    }

    ::Components::EnterpriseComponent* enterprise_component = 
        local_home->create();
    %(LocalComponent)sCCM_%(ComponentType)s* local_component = 
        dynamic_cast< %(LocalComponent)sCCM_%(ComponentType)s*>(enterprise_component);
    %(ComponentType)s* local_component_adapter = 
        new %(ComponentType)s(this, local_component, assembly);
    SmartPtr< %(ComponentType)s > ret(local_component_adapter);

    if(assembly_factory != SmartPtr< ::Components::AssemblyFactory>()) 
    {
        assembly->build(ret);
    }
    return ret;
}

void
%(Identifier)s::remove_component(
    SmartPtr< ::Components::CCMObject> component)
    throw(::Components::CCMException, ::Components::RemoveFailure)
{
    component->remove();
}

SmartPtr< ::Components::CCMObject>
%(Identifier)s::create_component()
    throw(::Components::CCMException, ::Components::CreateFailure)
{
    return create();
}

%(CloseNamespace)s


//==============================================================================
// entry point
//==============================================================================

wamas::platform::utils::SmartPtr< ::Components::CCMHome>
create_%(AbsoluteLocalHomeName)sAdapter()
{
    wamas::platform::utils::SmartPtr< ::Components::CCMHome>
        ret(new %(LocalNamespace)s%(Identifier)s());
    return ret;
}

int 
deploy_%(AbsoluteLocalHomeName)s(char* name)
{
    return deploy_with_assembly_%(AbsoluteLocalHomeName)s(
        name, wamas::platform::utils::SmartPtr< ::Components::AssemblyFactory>());	
}	

int 
deploy_with_assembly_%(AbsoluteLocalHomeName)s(char* name,
    wamas::platform::utils::SmartPtr< ::Components::AssemblyFactory> assembly_factory)
{
    try 
    {
        wamas::platform::utils::SmartPtr< ::Components::CCMHome> 
            ret(new %(LocalNamespace)s%(Identifier)s(assembly_factory));
        ::Components::HomeFinder::Instance()->register_home(ret, name);
    }
    catch(...) 
    {
        return -1;
    }
    return 0; 
}	

int 
undeploy_%(AbsoluteLocalHomeName)s(char* name)
{
    try 
    {
        ::Components::HomeFinder::Instance()->unregister_home(name);	
    } 
    catch(...) 
    {
        return -1;
    }
    return 0;
}



<<<<<<<SPLIT>>>>>>>
/*
 * This file was automatically generated by %(CcmToolsVersion)s
 * <http://ccmtools.sourceforge.net/>
 * DO NOT EDIT !
 */

//==============================================================================
// %(Identifier)s - shared class definitions
//==============================================================================

#ifndef __HOME_%(PreprocIdentifier)s_SHARE__H__
#define __HOME_%(PreprocIdentifier)s_SHARE__H__

#include <Components/CCM.h>

%(MFactoryDefInclude)s
%(MFinderDefInclude)s
%(MSupportsDefInclude)s
%(BaseInclude)s

%(OpenNamespace)s

//==============================================================================
// home classes
//==============================================================================

class CCM_%(Identifier)sExplicit
    : virtual public ::Components::HomeExecutorBase
{
  public:
    virtual ~CCM_%(Identifier)sExplicit() {}
    
%(MFactoryDefPrototypeVV)s
};


class CCM_%(Identifier)sImplicit
{
  public:
    virtual ~CCM_%(Identifier)sImplicit() {}
  
    virtual ::Components::EnterpriseComponent* create()
        throw(::Components::CCMException) = 0;
};


class CCM_%(Identifier)s
    : virtual public CCM_%(Identifier)sExplicit, 
      virtual public CCM_%(Identifier)sImplicit%(BaseType)s%(MSupportsDefBase)s
{
  public:
    virtual ~CCM_%(Identifier)s() {}
};

%(CloseNamespace)s

#endif // __HOME_%(PreprocIdentifier)s_SHARE__H__


<<<<<<<SPLIT>>>>>>>
/*
 * This file was automatically generated by %(CcmToolsVersion)s
 * <http://ccmtools.sourceforge.net/>
 * DO NOT EDIT !
 */

//==============================================================================
// %(Identifier)s - entry point
//==============================================================================

#ifndef __HOME_%(PreprocIdentifier)s_ENTRY__H__
#define __HOME_%(PreprocIdentifier)s_ENTRY__H__

::Components::HomeExecutorBase* 
create%(AbsoluteLocalHomeName)s();

#endif // __HOME_%(PreprocIdentifier)s_ENTRY__H__


<<<<<<<SPLIT>>>>>>>
/***
 * This file was automatically generated by %(CcmToolsVersion)s
 * <http://ccmtools.sourceforge.net/>
 *
 * %(Identifier)s home business logic definition.
 * 
 * // TODO: WRITE YOUR DESCRIPTION HERE! 
 *
 * @author
 * @version 
 ***/

#ifndef __HOME_%(PreprocIdentifier)s_IMPL__H__
#define __HOME_%(PreprocIdentifier)s_IMPL__H__

#include <%(HomeInclude)s_share.h>

%(OpenNamespace)s

/**
 * This class implements a component home's attributes and factory methods.
 * CCM_%(Identifier)s home class 
 *
 * // TODO: WRITE YOUR DESCRIPTION HERE! 
 *
 * @author
 * @version 
 **/
class %(Identifier)s_impl
    : virtual public %(LocalNamespace)sCCM_%(Identifier)s%(BaseType)s
{
  public:
    %(Identifier)s_impl();
    virtual ~%(Identifier)s_impl();

    virtual ::Components::EnterpriseComponent* create()
        throw(::Components::CCMException);

%(MFactoryDefPrototypeV)s
};

%(CloseNamespace)s

#endif


<<<<<<<SPLIT>>>>>>>
/*
 * This file was automatically generated by %(CcmToolsVersion)s
 * <http://ccmtools.sourceforge.net/>
 *
 * %(Identifier)s home business logic implementation.
 * 
 * // TODO: WRITE YOUR DESCRIPTION HERE! 
 *
 * @author
 * @version 
 ***/

#include <cassert>
#include <iostream>

#include "%(ComponentType)s_impl.h"
#include "%(Identifier)s_impl.h"
#include "%(AbsoluteLocalHomeName)s_entry.h"

%(OpenNamespace)s

using namespace std;
using namespace wamas::platform::utils;

//==============================================================================
// %(Identifier)s_impl - home implementation 
//==============================================================================

%(Identifier)s_impl::%(Identifier)s_impl()
{
    // OPTIONAL : IMPLEMENT ME HERE !
}

%(Identifier)s_impl::~%(Identifier)s_impl()
{
    // OPTIONAL : IMPLEMENT ME HERE !
}

::Components::EnterpriseComponent*
%(Identifier)s_impl::create()
    throw(::Components::CCMException)
{
    return dynamic_cast< ::Components::EnterpriseComponent* >
        (new %(ComponentType)s_impl());
}

%(MFactoryDefImplDefinition)s

%(CloseNamespace)s


//==============================================================================
// CCM_%(Identifier)s - home entry point
//==============================================================================

::Components::HomeExecutorBase*
create%(AbsoluteLocalHomeName)s()
{
    return dynamic_cast< ::Components::HomeExecutorBase* >
        (new %(LocalNamespace)s%(Identifier)s_impl());
}

