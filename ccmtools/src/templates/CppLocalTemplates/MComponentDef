/*
 * This file was automatically generated by %(CcmToolsVersion)s 
 * <http://ccmtools.sourceforge.net>
 * DO NOT EDIT! 
 */

//==============================================================================
// %(Identifier)s - component logic (header)
//==============================================================================

#ifndef __COMPONENT_%(PreprocIdentifier)s_GEN__H__
#define __COMPONENT_%(PreprocIdentifier)s_GEN__H__

#include <string>
#include <map>

#include <Components/ccmtools.h>

#include <%(ComponentInclude)s_share.h>
#include <%(HomeInclude)s_share.h>

%(MAttributeDefInclude)s
%(MConstantDefInclude)s
%(MSupportsDefInclude)s
%(MProvidesDefInclude)s
%(MConsumesDefInclude)s
%(MEmitsDefInclude)s
%(MPublishesDefInclude)s
%(MUsesDefInclude)s
%(BaseInclude)s

%(OpenNamespace)s

class %(HomeType)s;

//==============================================================================
// %(Identifier)s local component adapter 
//==============================================================================

class %(Identifier)s
    : virtual public ::Components::CCMObject 
      %(MSupportsDefBase)s
      %(BaseType)s 	
{
  public:
    typedef wamas::platform::utils::SmartPtr<%(Identifier)s> SmartPtr;
    
    %(Identifier)s(%(HomeType)s* h, 
        %(LocalNamespace)sCCM_%(Identifier)s* lc, ::Components::Assembly::SmartPtr a);
    virtual ~%(Identifier)s();

%(MAttributeDefPrototype)s
%(MProvidesDefProvidePrototype)s
%(MUsesDefConnectPrototype)s
%(MUsesDefGetConnectionPrototype)s

    // Navigation functions
    ::Components::Object::SmartPtr 
    provide_facet(const std::string& name)
        throw(::Components::InvalidName);

    // Receptacle functions
    ::Components::Cookie 
    connect(const ::Components::FeatureName& name, 
        ::Components::Object::SmartPtr connection)
        throw(::Components::InvalidName, 
              ::Components::InvalidConnection,
              ::Components::AlreadyConnected, 
              ::Components::ExceededConnectionLimit);

    void 
    disconnect(const ::Components::FeatureName& name, 
        const ::Components::Cookie& ck)
        throw(::Components::InvalidName, 
              ::Components::InvalidConnection,
              ::Components::CookieRequired, 
              ::Components::NoConnection );

    // CCMObject functions
    ::Components::HomeExecutorBase* get_ccm_home();

    void configuration_complete()
        throw(::Components::InvalidConfiguration);

    void configuration_complete(%(LocalNamespace)sCCM_%(Identifier)s_Context* ctx)
        throw(::Components::InvalidConfiguration);

    void remove()
        throw(::Components::RemoveFailure);
 
   protected:
    %(HomeType)s* home_local_adapter;
    %(LocalNamespace)sCCM_%(Identifier)s* local_component;
    %(LocalNamespace)sCCM_%(Identifier)s_Context* context;
    ::Components::Assembly::SmartPtr assembly;
    bool ValidConnection;

%(MProvidesDefAdapterVariable)s
%(MUsesDefAdapterVariable)s
        
  private:
    %(Identifier)s(const %(Identifier)s&);
    void operator=(const %(Identifier)s&);
};


//==============================================================================
// context adapter class
//==============================================================================

class CCM_%(Identifier)s_Context_impl
    : public %(LocalNamespace)sCCM_%(Identifier)s_Context
{
  public:
    CCM_%(Identifier)s_Context_impl(%(Identifier)s* c);
    virtual ~CCM_%(Identifier)s_Context_impl();

%(MUsesDefGetCtxConnectionPrototype)s

    // CCMContext function
    ::Components::HomeExecutorBase* get_CCM_home();

    // SessionContext function	
    ::Components::Object* get_CCM_object()
        throw(::Components::IllegalState);

  protected:
    %(Identifier)s* component_local_adapter;
        
  private:
    CCM_%(Identifier)s_Context_impl(const CCM_%(Identifier)s_Context_impl&);
    void operator=(const CCM_%(Identifier)s_Context_impl&);
};

%(CloseNamespace)s

#endif


<<<<<<<SPLIT>>>>>>>
/*
 * This file was automatically generated by %(CcmToolsVersion)s
 * <http://ccmtools.sourceforge.net/>
 * DO NOT EDIT !
 */

//==============================================================================
// %(Identifier)s - component logic (implementation)
//==============================================================================

#include <cassert>
#include <iostream>
#include <sstream>

#ifdef HAVE_CONFIG_H
#include <config.h>
#endif

%(MProvidesDefAdapterInclude)s

#include "%(Identifier)s_gen.h"

%(OpenNamespace)s

using namespace std;

//==============================================================================
// local component adapter implementation
//==============================================================================

%(Identifier)s::%(Identifier)s(%(HomeType)s* h, 
    %(LocalNamespace)sCCM_%(Identifier)s* lc, ::Components::Assembly::SmartPtr a)
    : %(MSupportsDefAdapterConstructor)s
    home_local_adapter(h), local_component(lc), assembly(a)
{
    context = NULL; 
    ValidConnection = true;
%(MProvidesDefAdapterVariableInit)s
%(MUsesDefAdapterVariableInit)s
}

%(Identifier)s::~%(Identifier)s()
{
    delete context;
    delete local_component;
    %(MProvidesDefAdapterVariableDestroy)s
}

%(MAttributeDefAdapterDefinition)s
%(MProvidesDefAdapterDefinition)s
%(MUsesDefAdapterDefinition)s

// Navigation functions

::Components::Object::SmartPtr
%(Identifier)s::provide_facet(const std::string& name)
    throw(::Components::InvalidName)
{
%(MProvidesDefProvideFacet)s
    throw ::Components::InvalidName();
}


// Receptacle functions

::Components::Cookie
%(Identifier)s::connect(const ::Components::FeatureName& name, 
                        ::Components::Object::SmartPtr connection)
    throw(::Components::InvalidName, 
          ::Components::InvalidConnection,
          ::Components::AlreadyConnected, 
          ::Components::ExceededConnectionLimit)
{
%(MUsesDefConnectFacet)s
    throw ::Components::InvalidName();
}

void
%(Identifier)s::disconnect(const ::Components::FeatureName& name, 
                           const ::Components::Cookie& ck)
    throw(::Components::InvalidName, 
          ::Components::InvalidConnection,
          ::Components::CookieRequired, 
          ::Components::NoConnection )
{
    if(!ValidConnection) 
        throw ::Components::InvalidConnection();

%(MUsesDefDisconnectFacet)s
    throw ::Components::InvalidName();
}


// CCMObject functions

::Components::HomeExecutorBase*
%(Identifier)s::get_ccm_home()
{
    throw ::Components::NotImplemented();
}


void
%(Identifier)s::configuration_complete()
    throw(::Components::InvalidConfiguration)
{
    configuration_complete(new CCM_%(Identifier)s_Context_impl(this));
}


void
%(Identifier)s::configuration_complete(%(LocalNamespace)sCCM_%(Identifier)s_Context* ctx)
    throw(::Components::InvalidConfiguration)
{
    if(!ValidConnection) 
        throw ::Components::InvalidConnection();
    if(!context)
      context = ctx;
    if(assembly != ::Components::Assembly::SmartPtr()) 
    { 
        assembly->configuration_complete(); 
    }
    local_component->set_session_context(context);
    local_component->ccm_activate();
}


void
%(Identifier)s::remove()
    throw(::Components::RemoveFailure)
{
    if(!ValidConnection) 
        throw ::Components::InvalidConnection();
    local_component->ccm_remove();
    
%(MProvidesDefImplRemove)s

    if(assembly != ::Components::Assembly::SmartPtr()) 
    { 
        assembly->tear_down(); 
        // To resolve a cyclic smart pointer reference between a component
        // and an assembly object, the assembly smart pointer must be cleaned.
        assembly = ::Components::Assembly::SmartPtr();
    }
    ValidConnection = false;
}


//==============================================================================
// context adapter class implementation
//==============================================================================

CCM_%(Identifier)s_Context_impl::CCM_%(Identifier)s_Context_impl(%(Identifier)s* c)
    : component_local_adapter(c)
{
}

CCM_%(Identifier)s_Context_impl::~CCM_%(Identifier)s_Context_impl()
{
}

%(MUsesDefGetConnectionCtxImplDefinition)s

::Components::HomeExecutorBase*
CCM_%(Identifier)s_Context_impl::get_CCM_home()
{
    throw ::Components::NotImplemented();
}

::Components::Object*
CCM_%(Identifier)s_Context_impl::get_CCM_object()
    throw(::Components::IllegalState)
{
    throw ::Components::NotImplemented();
}

%(CloseNamespace)s


<<<<<<<SPLIT>>>>>>>
/*
 * This file was automatically generated by %(CcmToolsVersion)s
 * <http://ccmtools.sourceforge.net/>
 * DO NOT EDIT !
 */

//==============================================================================
// %(Identifier)s - shared class definitions
//==============================================================================

#ifndef __COMPONENT_%(PreprocIdentifier)s_SHARE__H__
#define __COMPONENT_%(PreprocIdentifier)s_SHARE__H__

#include <map>

#include <Components/ccmtools.h>

%(MAttributeDefInclude)s
%(MConstantDefInclude)s
%(MSupportsDefInclude)s
%(MProvidesDefInclude)s
%(MConsumesDefInclude)s
%(MEmitsDefInclude)s
%(MPublishesDefInclude)s
%(BaseInclude)s
%(MUsesDefInclude)s

%(OpenNamespace)s

//==============================================================================
// Component class
//==============================================================================

class CCM_%(Identifier)s
    : virtual public ::Components::SessionComponent%(BaseType)s%(MSupportsDefBase)s
{
  public:
    typedef wamas::platform::utils::SmartPtr<CCM_%(Identifier)s> SmartPtr;
    
    virtual ~CCM_%(Identifier)s() {}

%(MAttributeDefPrototypeVV)s
%(MProvidesDefGetFacetPrototypeVV)s
%(MSupportsDefImplPrototypeVV)s
};


//==============================================================================
// Context class
//==============================================================================

%(MUsesDefConnectionMap)s

class CCM_%(Identifier)s_Context
    : virtual public ::Components::SessionContext
{
  public:
    typedef wamas::platform::utils::SmartPtr<CCM_%(Identifier)s_Context> SmartPtr;  
  
    virtual ~CCM_%(Identifier)s_Context() {}
    
%(MUsesDefGetConnectionPrototypeVV)s
};

%(CloseNamespace)s

#endif // __COMPONENT_%(PreprocIdentifier)s_SHARE__H__


<<<<<<<SPLIT>>>>>>>
/***
 * This file was automatically generated by %(CcmToolsVersion)s
 * <http://ccmtools.sourceforge.net/>
 *
 * %(Identifier)s component business logic definition.
 * 
 * // TODO: WRITE YOUR DESCRIPTION HERE! 
 *
 * @author
 * @version 
 ***/

#ifndef __COMPONENT_%(PreprocIdentifier)s_IMPL__H__
#define __COMPONENT_%(PreprocIdentifier)s_IMPL__H__

#include <%(ComponentInclude)s_share.h>
%(AssemblyInnerComponentInclude)s

%(OpenNamespace)s

/**
 * This class implements a component's equivalent and supported interfaces
 * as well as component attributes. Additionally, session component callback 
 * methods must be implemented.  
 *
 * %(Identifier)s component class 
 *
 * // TODO: WRITE YOUR DESCRIPTION HERE! 
 *
 * @author
 * @version 
 **/
class %(Identifier)s_impl
    : virtual public %(LocalNamespace)sCCM_%(Identifier)s%(BaseType)s%(AssemblyImplBase)s
{
  private:
%(MAttributeDefVariable)s
%(MSupportsDefVariable)s
%(AssemblyInnerComponentVariable)s
    bool ccm_activate_ok;

  public:
    %(LocalNamespace)sCCM_%(Identifier)s_Context* ctx;

    %(Identifier)s_impl();
    virtual ~%(Identifier)s_impl();

%(AssemblyImplPrototype)s
%(MAttributeDefPrototype)s
%(MProvidesDefGetFacetPrototype)s
%(MSupportsDefImplPrototype)s

    // CCM callback methods

    virtual void set_session_context(Components::SessionContext* ctx)
        throw(Components::CCMException);

    virtual void ccm_activate()
        throw(Components::CCMException);

    virtual void ccm_passivate()
        throw(Components::CCMException);

    virtual void ccm_remove()
        throw(Components::CCMException);
};

%(CloseNamespace)s

#endif


<<<<<<<SPLIT>>>>>>>
/***
 * This file was automatically generated by %(CcmToolsVersion)s
 * <http://ccmtools.sourceforge.net/>
 *
 * %(Identifier)s component business logic implementation.
 * 
 * // TODO: WRITE YOUR DESCRIPTION HERE! 
 *
 * @author
 * @version 
 ***/

#include <cassert>
#include <iostream>

#include "%(Identifier)s_impl.h"
%(MProvidesDefImplInclude)s
%(AssemblyInnerHomeInclude)s

%(OpenNamespace)s

using namespace std;

//==============================================================================
// %(Identifier)s - component implementation
//==============================================================================

%(Identifier)s_impl::%(Identifier)s_impl()
: ccm_activate_ok(false)
{
%(MProvidesDefGetFacetPointerInit)s
%(AssemblyInnerComponentVariableCreation)s
}

%(Identifier)s_impl::~%(Identifier)s_impl()
{
}

%(MAttributeDefImplDefinition)s
%(MSupportsDefImplDefinition)s

void
%(Identifier)s_impl::set_session_context(Components::SessionContext* context)
    throw(Components::CCMException)
{
    ctx = dynamic_cast< %(LocalNamespace)sCCM_%(Identifier)s_Context* >(context);
}

void
%(Identifier)s_impl::ccm_activate()
    throw(Components::CCMException)
{
    try {
%(AssemblyCcmActivate)s
    } catch(...) {
        throw Components::CCMException(Components::CREATE_ERROR);
    }
    ccm_activate_ok = true;
}

void
%(Identifier)s_impl::ccm_passivate()
    throw(Components::CCMException)
{
    // Who calls this method?
}

void
%(Identifier)s_impl::ccm_remove()
    throw(Components::CCMException)
{
    try {
%(AssemblyCcmRemove)s
    } catch(...) {
        throw Components::CCMException(Components::REMOVE_ERROR);
    }
}

%(AssemblyImplDefinition)s
%(MProvidesDefGetFacetDefinition)s

%(CloseNamespace)s

