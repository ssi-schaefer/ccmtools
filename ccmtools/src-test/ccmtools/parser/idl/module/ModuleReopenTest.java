package ccmtools.parser.idl.module;

import java.io.FileNotFoundException;
import java.util.List;

import junit.framework.Test;
import junit.framework.TestSuite;
import ccmtools.CcmtoolsException;
import ccmtools.metamodel.CcmModelHelper;
import ccmtools.metamodel.BaseIDL.MInterfaceDef;
import ccmtools.metamodel.BaseIDL.MModuleDef;


public class ModuleReopenTest extends ModuleTest
{
    public ModuleReopenTest()
        throws FileNotFoundException
    {
        super(ModuleReopenTest.class.getName());
    }
        
    public static Test suite()
    {
        return new TestSuite(ModuleReopenTest.class);
    }
    
    public void testDifferentModulesReopened() throws CcmtoolsException, FileNotFoundException
    {
        List<MModuleDef> modules = ModuleTest.parseSourceList(
                "module europe " +
                "{" +
                "   interface IFaceA {};" +
                "};" +
                
                "module america" +
                "{" +
                "   interface IFaceB {};" +
                "};");

        {
            MModuleDef module = modules.get(0);
            assertEquals("IDL:europe:1.0", CcmModelHelper.getRepositoryId(module));
            assertTrue(module.getContentss().get(0) instanceof MInterfaceDef);
            MInterfaceDef iface = (MInterfaceDef)module.getContentss().get(0);
            assertEquals("IDL:europe/IFaceA:1.0", CcmModelHelper.getRepositoryId(iface));
        }
        {
            MModuleDef module = modules.get(1);
            assertEquals("IDL:america:1.0", CcmModelHelper.getRepositoryId(module));
            assertTrue(module.getContentss().get(0) instanceof MInterfaceDef);
            MInterfaceDef iface = (MInterfaceDef)module.getContentss().get(0);
            assertEquals("IDL:america/IFaceB:1.0", CcmModelHelper.getRepositoryId(iface));
        }
    }      

    
    public void testModulesReopened() throws CcmtoolsException, FileNotFoundException
    {
        List<MModuleDef> modules = ModuleTest.parseSourceList(
                "module world " +
                "{" +
                "   interface IFaceA {};" +
                "};" +
                
                "module world" +
                "{" +
                "   interface IFaceB {};" +
                "};");
        
        {
            MModuleDef module = modules.get(0);
            assertEquals("IDL:world:1.0", CcmModelHelper.getRepositoryId(module));       
            assertTrue(module.getContentss().get(0) instanceof MInterfaceDef);
            MInterfaceDef iface = (MInterfaceDef)module.getContentss().get(0);
            assertEquals("IDL:world/IFaceA:1.0", CcmModelHelper.getRepositoryId(iface));
        }
        {
            MModuleDef module = modules.get(1);
            assertEquals("IDL:world:1.0", CcmModelHelper.getRepositoryId(modules.get(1)));
            assertTrue(module.getContentss().get(0) instanceof MInterfaceDef);
            MInterfaceDef iface = (MInterfaceDef)module.getContentss().get(0);
            assertEquals("IDL:world/IFaceB:1.0", CcmModelHelper.getRepositoryId(iface));
        }
    }      

}
