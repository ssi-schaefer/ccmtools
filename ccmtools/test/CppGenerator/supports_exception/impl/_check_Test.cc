/***
 * CCM Tools Test Client 
 *
 * This file was automatically generated by the CCM Tools.
 *         <http://ccmtools.sourceforge.net/>
 *
 * This test client is part of the mirror component test concept. For each
 * component a corresponding mirror component will be instantiated. 
 * All component ports will be connected to the mirror component's ports. 
 * Additionally, developers can add some testing code to validate supported
 * interfaces as well as component attribute access.
 ***/

#include <cassert>
#include <iostream>

#include <wamas/platform/utils/smartptr.h>

#include <Components/ccm/local/CCM.h>
#include <ccm/local/HomeFinder.h>

#include <TestHome_gen.h>

using namespace std;
using namespace wamas::platform::utils;

int main(int argc, char *argv[])
{
    cout << ">>>> Start Test Client: " << __FILE__ << endl;

    int error = 0;
    Components::ccm::local::HomeFinder* homeFinder = ccm::local::HomeFinder::Instance();

    error  = deploy_TestHome("TestHome");
    
    if(error) 
    {
        cerr << "BOOTSTRAP ERROR: Can't deploy component homes!" << endl;
        return(error);
    }

    try 
    {    
	    SmartPtr<Test> myTest;
        SmartPtr<TestHome> myTestHome(dynamic_cast<TestHome*>
            (homeFinder->find_home_by_name("TestHome").ptr()));

        myTest = myTestHome->create();
        myTest->configuration_complete();

	    string s = "Salomon.Automation";
	    long len =  myTest->print(s);
		assert(len == s.length());
  
  		try
    		{
        		string s = "Error";
        		myTest->print(s);
        		assert(0);
    		}
    		catch(Error& e) 
    		{
        		cout << "OK: error exception catched! ";
        		cout << "(" 
             << e.info[0].code << ", " 
             << e.info[0].message << ")" 
             << "[ " << e.what() << "]"
             << endl;
    		}
    
    		try 
    		{
        		string s = "SuperError";
        		myTest->print(s);
        		assert(0);
    		}
    		catch(SuperError& e) 
    		{
        		cout << "OK: super_error exception catched! "
        			 << "[ " << e.what() << "]"
        		 	 << endl;
    		}
  
    		try 
    		{
        		string s = "FatalError";
        		myTest->print(s);
        		assert(0);
    		}
    		catch(FatalError& e) 
    		{
        		cout << "OK: fatal_error exception catched! " 
        			 << "[ " << e.what() << "]"
        			 << endl;
    		}

        myTest->remove();
    } 
    catch ( ::Components::ccm::local::HomeNotFound ) 
    {
        cout << "DEPLOYMENT ERROR: can't find a home!" << endl;
        return -1;
    } 
    catch ( ::Components::ccm::local::NotImplemented& e ) 
    {
        cout << "DEPLOYMENT ERROR: function not implemented: " 
	     << e.what (  ) << endl;
        return -1;
    }  
    catch ( ::Components::ccm::local::InvalidName& e ) 
    {
        cout << "DEPLOYMENT ERROR: invalid name during connection: " 
             << e.what (  ) << endl;
        return -1;
    }
    catch ( ... )  
    {
        cout << "DEPLOYMENT ERROR: there is something wrong!" << endl;
        error = -1;
    }
    if (error < 0) 
    {
        return error;
    }

    error = undeploy_TestHome("TestHome");
    if(error) 
    {
        cerr << "TEARDOWN ERROR: Can't undeploy component homes!" << endl;
        return error;
    }
    
    cout << ">>>> Stop Test Client: " << __FILE__ << endl;
}
