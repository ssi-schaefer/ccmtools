<!--
$Header$
-->

<project name="java-environment" default="uml2idl.jar">

  <description>
  This project contains java tools used by the ccmtools project.
  Note that all tools in java-environment can be built and used
  without the ccmtools package.   
  </description>

  <!-- Define properties that are used in the following tasks.
       Note that a property can be set from command-line:
          $ ant -Dprefix=/usr/local
  -->
  <property name="src" location="src" />
  <property name="build0" location="build" />
  <property name="build2" location="build/U" />
  <property name="build3" location="build/M" />
  <property name="lib" location="lib" />
  <property name="doc" location="doc" />
  <property name="prefix" location="dist" />
  <property name="DEBUG" location="on" />


  <!-- Define different paths that are used in the following tasks -->
  <path id="compile.classpath">
      <pathelement location="${lib}/antlr.jar" />
  </path>

  <path id="run.classpath">
      <fileset dir="${lib}">
          <include name="*.jar" />
      </fileset>	  
      <pathelement path="${java.class.path}" />
  </path>



  <!-- Define the tasks needed to build and test ccmtools.uml2idl -->

  <target name="init"
      description="Creates the build directory and deletes the old jar files." >
      <mkdir dir="${build0}" />
      <mkdir dir="${build2}" />
      <mkdir dir="${build3}" />
  </target>


  <!-- UML parser and uml2idl -->

  <target name="uml_parser" depends="init"
      description="Run the dtd2java tool to create the uml_parser package.">
      <java classname="dtd2java.Main">
          <classpath refid="run.classpath" />
	  <arg value="${src}/dtd2java/UML.dtd" />
	  <arg value="uml_parser" />
	  <arg value="src" />
      </java>
  </target>


  <target name="uml2idl" depends="uml_parser"
      description="Compile the whole ccmtools package (uml_parser and uml2idl).">
        <javac srcdir="${src}/uml_parser" destdir="${build2}" debug="on" >
	    <classpath refid="compile.classpath" />
        </javac>
        <javac srcdir="${src}/uml2idl" destdir="${build2}" debug="on" >
	    <classpath refid="compile.classpath" />
        </javac>
  </target>


  <target name="uml2idl.jar" depends="uml2idl"
      description="Package the *.class files into uml2idl.jar.">
      <jar jarfile="${lib}/uml2idl.jar" basedir="${build2}" >
         <manifest>
            <attribute name="Main-Class" value="uml2idl.Main" />
         </manifest>
      </jar>
  </target>


  <!-- MOF reader -->

  <target name="mof_xmi_parser" depends="init"
      description="Run the dtd2java tool to create the mof_xmi_parser package.">
      <java classname="dtd2java.Main">
          <classpath refid="run.classpath" />
      <arg value="${src}/dtd2java/MOF14XMI11.dtd" />
      <arg value="mof_xmi_parser" />
      <arg value="src" />
      <arg value="Id" />
      </java>
  </target>


  <target name="mof_reader" depends="mof_xmi_parser"
      description="Compile mof_xmi_parser and mof_reader.">
        <javac srcdir="${src}/mof_xmi_parser" destdir="${build3}" debug="${DEBUG}" >
	    <classpath refid="compile.classpath" />
        </javac>
        <javac srcdir="${src}/mof_reader" destdir="${build3}" debug="${DEBUG}" >
	    <classpath refid="compile.classpath" />
        </javac>
  </target>


  <target name="mof_reader.jar" depends="mof_reader"
      description="Package the *.class files into mof_reader.jar.">
      <jar jarfile="${lib}/mof_reader.jar" basedir="${build3}" >
         <manifest>
            <attribute name="Main-Class" value="mof_reader.Main" />
         </manifest>
      </jar>
  </target>


  <!-- uml2idl Test -->

  <target name="test" depends="uml2idl.jar" 
      description="Run the uml2idl tool to test the created package.">
      <java classname="uml2idl.Main" >
          <classpath refid="run.classpath" />
	  <arg value="test/u1.xml.zip" />
	  <arg value="u1" />
      </java>
  </target>


  <!-- Create javaDoc -->

  <target name="doc" 
      description="Generates javadoc for the uml_parser and uml2idl package.">
      <javadoc packagenames="uml_parser, uml2idl"
               sourcepath="${src}"
	       destDir="${build}/javadoc">
      </javadoc>
  </target>


  <!-- Install java-environment -->

  <target name="install"  depends="uml2idl.jar" 
      description="Install java-environment to prefix/.">
      <mkdir dir="${prefix}" />
      <copy file="${lib}/antlr.jar"    todir="${prefix}/lib"  overwrite="true" />       
      <copy file="${lib}/mdr01.jar"    todir="${prefix}/lib"  overwrite="true" />       
      <copy file="${lib}/jdom.jar"     todir="${prefix}/lib"  overwrite="true" />       

      <copy file="${lib}/dtd2java.jar" todir="${prefix}/lib"  overwrite="true" />       
      <copy file="${lib}/uml2idl.jar"  todir="${prefix}/lib"  overwrite="true" />
  </target>


  <!-- Clean up -->

  <target name="clean"
      description="Clean up the build and lib directory." >
      <delete dir="${src}/uml_parser" />
      <delete dir="${src}/mof_xmi_parser" />

      <delete dir="${build0}" />

      <delete file="${lib}/uml2idl.jar" /> 
      <delete file="${lib}/mof_reader.jar" />

      <delete file="u1.idl" />
      <delete file="u1.ocl" />
  </target>

</project>
